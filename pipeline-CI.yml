trigger:
  batch: true
  branches:
    include:
    - master

pool:
  vmImage: 'ubuntu-latest'

variables:
  iot_imageName: 'iotdevice'
  router_imageName: 'messagerouter'

steps:
- task: Docker@2
  displayName: Build and push IoT Device Image
  inputs:
    repository: $(iot_imageName)
    command: build
    Dockerfile: Microsoft.OneWeek.Hack.Microids.IoTDevice/Dockerfile
    containerRegistry: 'Azure CR'
    
- task: Docker@2
  displayName: Build and push Message Router Image
  inputs:
    repository: $(router_imageName)
    command: buildAndPush
    Dockerfile: Microsoft.OneWeek.Hack.Microids.MessageRouter/Dockerfile
    containerRegistry: 'Azure CR'
